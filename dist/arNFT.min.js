!function(){"use strict";var e=function(e,t,a){this.width=e,this.height=t,this.root=new THREE.Object3D,this.root.matrixAutoUpdate=!1,this.config=a};e.prototype.init=function(e,n){this.cameraPara;var i=this.root;(async function(e,t){return await new Promise((function(t,a){let n=new XMLHttpRequest;n.open("GET",e),n.responseType="json",n.onload=function(){t(n.response)},n.onerror=function(){a("error "+n.status)},n.send(null)}))})(this.config).then((function(o){!function(e){var t=document.createElement("div");t.id="loading";var a=document.createElement("img");a.src=e.loading.logo.src,a.alt=e.loading.logo.alt;var n=document.createElement("span");n.setAttribute("class","loading-text"),n.innerText=e.loading.loadingMessage,t.appendChild(a),t.appendChild(n);document.getElementById("marker");document.body.insertBefore(t,document.body.firstChild)}(o),function(e){if(e){var t=document.createElement("div");t.id="stats",t.className="ui stats";var a=document.createElement("div");a.id="stats1",a.className="stats-item";var n=document.createElement("p");n.className="stats-item-title",n.innerText="Main",a.appendChild(n),t.appendChild(a);var i=document.createElement("div");i.id="stats2",i.className="stats-item";var o=document.createElement("p");o.className="stats-item-title",o.innerText="Worker",i.appendChild(o),t.appendChild(i);var r=document.getElementById("loading");document.body.insertBefore(t,r)}}(n);var r=function(){var e=document.createElement("div");e.id="app";var t=document.createElement("canvas");t.id="canvas";var a=document.createElement("video");a.id="video",a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.setAttribute("playsinline",""),e.appendChild(a),e.appendChild(t);var n=document.getElementById("loading");return document.body.insertBefore(e,n),{container:e,canvas:t,video:a}}(),d=(r.container,r.canvas),s=r.video;if(n){var l=new Stats;l.showPanel(0),document.getElementById("stats1").appendChild(l.dom);var c=new Stats;c.showPanel(0),document.getElementById("stats2").appendChild(c.dom)}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var m={audio:!1,video:!0};window.innerWidth<800&&(m={audio:!1,video:{width:{ideal:this.width},height:{ideal:this.height},facingMode:{exact:"environment"}}}),navigator.mediaDevices.getUserMedia(m).then((function(r){s.srcObject=r,s.addEventListener("loadedmetadata",(function(){s.play(),function(e,n,i,o,r,d,s,l,c,m){var u,p,v,h,f,g,E,w,y,x,b,T,R,C=document.createElement("canvas"),M=C.getContext("2d"),k=new THREE.WebGLRenderer({canvas:d,alpha:m.renderer.alpha,antialias:m.renderer.antialias,precision:m.renderer.precision});k.setPixelRatio(window.devicePixelRatio);var A=new THREE.Scene,H=new THREE.Camera;H.matrixAutoUpdate=!1,A.add(H);var P=new THREE.AmbientLight(16777215);A.add(P),A.add(c);var B,I=function(e){B=e?JSON.parse(e.matrixGL_RH):null},S=Date.now();function L(){M.fillStyle="black",M.fillRect(0,0,y,x),M.drawImage(i,0,0,u,p,b,T,E,w);var e=M.getImageData(0,0,y,x);R.postMessage({type:"process",imagedata:e},[e.data.buffer])}var U=function(){D(),requestAnimationFrame(U)},D=function(){s();var e=Date.now();if(e-S,S=e,B){c.visible=!0;for(var n=0;n<16;n++)t.delta[n]=B[n]-t.interpolated[n],t.interpolated[n]=t.interpolated[n]+t.delta[n]/24;a(c.matrix,t.interpolated)}else c.visible=!1;k.render(A,H)};u=o,p=r,f=320/Math.max(u,p/3*4),g=/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)?window.outerWidth/o:1,v=u*g,h=p*g,E=u*f,w=p*f,y=Math.max(E,w/3*4),x=Math.max(w,E/4*3),b=(y-E)/2,T=(x-w)/2,C.style.clientWidth=y+"px",C.style.clientHeight=x+"px",C.width=y,C.height=x,k.setSize(v,h),(R=new Worker(m.workerUrl)).postMessage({type:"load",pw:y,ph:x,camera_para:m.cameraPara,marker:n,artoolkitUrl:m.artoolkitUrl}),R.onmessage=function(e){var t=e.data;switch(t.type){case"loaded":var n=JSON.parse(t.proj),i=y/E,o=x/w;n[0]*=i,n[4]*=i,n[8]*=i,n[12]*=i,n[1]*=o,n[5]*=o,n[9]*=o,n[13]*=o,a(H.projectionMatrix,n);break;case"endLoading":if(1==t.end){var r=document.getElementById("loading");r&&(r.querySelector(".loading-text").innerText="Start the tracking!",setTimeout((function(){r.parentElement.removeChild(r)}),2e3))}break;case"found":I(t);break;case"not found":I(null)}l(),L()},U(),L()}(0,e,s,s.videoWidth,s.videoHeight,d,(function(){n&&l.update()}),(function(){n&&c.update()}),i,o)}))})).catch((function(e){console.log(e.name+": "+e.message)}))}}))},e.prototype.add=function(e){this.root.add(e)},e.prototype.loadModel=function(e,t,a,n,i){var o,r=this.root;(new THREE.GLTFLoader).load(e,(function(e){(o=e.scene).scale.set(i,i,i),o.rotation.x=Math.PI/2,o.position.x=t,o.position.y=a,o.position.z=n,r.matrixAutoUpdate=!1,r.add(o)}))};var t={delta:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],interpolated:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=function(e,t){var a=[];for(var n in t)a[n]=t[n];"function"==typeof e.elements.set?e.elements.set(a):e.elements=[].slice.call(a)};window.ARnft=e,window.THREE=THREE}();